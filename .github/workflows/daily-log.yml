name: Daily Learning Log Commit

permissions:
  contents: write

on:
  schedule:
    - cron: '30 3 * * *' # 9:00 AM IST
  workflow_dispatch:

jobs:
  daily-log:
    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v3

      - name: Update daily learning log (random, natural)
        run: |
          FILE="daily-log.md"

          # Create markdown table if not exists
          if [ ! -f "$FILE" ]; then
            echo "| Date | Area | Topic | What I Learned / Practiced |" >> $FILE
            echo "|------|------|-------|---------------------------|" >> $FILE
          fi

          ITEMS=(
            "DSA|Arrays|Revised array traversal and edge cases."
            "DSA|Binary Search|Handled boundary conditions carefully."
            "Web Dev|React|Revised useState and useEffect usage."
            "Web Dev|Node.js|Studied event loop behavior."
            "Python|OOP|Revised classes and inheritance."
            "ML|Linear Regression|Studied model training basics."
            "DBMS|Normalization|Revised 1NF to BCNF."
            "OS|CPU Scheduling|Studied FCFS and Round Robin."
            "CN|TCP vs UDP|Compared reliability differences."
            "Git|Rebase|Understood rebase vs merge."
          )

          COMMITS=$(( (RANDOM % 3) + 1 ))

          for ((i=1; i<=COMMITS; i++)); do
            RANDOM_INDEX=$(( RANDOM % ${#ITEMS[@]} ))
            IFS="|" read AREA TOPIC NOTES <<< "${ITEMS[$RANDOM_INDEX]}"
            echo "| $(date '+%Y-%m-%d') | $AREA | $TOPIC | $NOTES |" >> $FILE
          done

      - name: Commit and push changes
        run: |
          git config --global user.name "Rajnish Kumar"
          git config --global user.email "rajnishkk97@gmail.com"
          git add daily-log.md
          git diff --cached --quiet || git commit -m "chore: update daily learning log"
          git push
